---
category: 电商
tag:
  - 电商
  - 方案
order: 2
---

# 电商订单设计方案

[电商业务流程时序.md](%E7%94%B5%E5%95%86%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%E6%97%B6%E5%BA%8F.md)

<!-- @include: ./电商业务流程时序.md#uml -->

## 电商订单的职责

1. 电商订单是记录电商平台上的交易信息的重要数据实体，包括订单号、商品信息、收货地址、支付信息等。
2. 电商订单具有以下职责：
   - 记录并管理交易信息：电商订单负责记录和管理商品信息、支付信息、物流信息等交易相关数据。
   - 控制交易流程：电商订单可以根据订单状态控制交易流程，如待支付、已支付、待发货、已发货、已完成等。
   - 支持订单查询和统计：电商订单可以提供订单查询和统计功能，以便用户和商家进行订单管理、交易分析等操作。
   - 支持订单修改和取消：电商订单可以支持用户和商家对订单进行修改和取消操作，以满足不同业务场景的需求。
   - 保证订单安全和隐私：电商订单需要采取相应的安全措施，确保订单信息的安全性和隐私性。
3. 电商订单的实现可以采用数据库存储、API接口调用等方式，具体的实现方式根据业务需求和系统架构进行选择。

---

@startuml
skin rose
class 订单信息 {
 + 订单id
 + 订单状态
 + 创建时间
 + 更新时间
 + 顾客信息
 + 商品信息[]
 + 支付信息
 
 + 生成订单id();
 + 创建订单();
 + 取消订单();
 + 支付订单();
 + 发货();
 + 签收();
 + 评价();
 + 完成();
}

class 商品信息 {
  + 商品id
  + 规格id
  + 应付价格
  + 销售价格
  + 促销信息
  + 物流信息
}

class 促销信息 {
  + 促销id
  + 促销规则
}

class 顾客信息 {
  + 顾客id
  + 收货地址信息
  + 联系信息
}

class 支付信息 {
  + 支付id
  + 支付渠道
  + 支付金额
  + 业务id
}

class 物流信息 {
  + 物流供应商
  + 物流id
}

订单信息 *-- 顾客信息
订单信息 *-- 商品信息
订单信息 *-- 支付信息


商品信息 *-- 促销信息
商品信息 *-- 物流信息

@enduml

---

## 核心API

+ 生成订单id();
+ 创建订单();
+ 取消订单();
+ 支付订单();
+ 发货();
+ 签收();
+ 评价();
+ 完成();

## 订单状态机设计
---


@startuml
state 初始化 #FFF111
state 已取消 #FFE111
state 已支付 #FFD111
state 已发货 #FFC111
state 已签收 #FFB111
state 已完成 #FFA111
state 开始售后 #FF9111
state 售后寄回 #FF8111
state 已退货未退款 #FF6111
state 已退款 #FF7111
state 售后完成 #FF5111

state start <<start>>
state end <<end>>

start --> 初始化 : 创建订单()
初始化 --> 已取消 : 取消订单()
初始化 --> 已支付 : 支付订单()
已支付 --> 已发货 : 发货()
已支付 --> 开始售后 : 我要退款

已发货 --> 已签收 : 签收()
已发货 --> 开始售后 : 我要退款

已签收 --> 已完成 : 完成()
已签收 --> 开始售后 : 我要退款

开始售后 --> 售后寄回 : 已签收
开始售后 --> 已退款 : 未发货/已发货未签收情况下退款

售后寄回 --> 已退货未退款 : 退回签收
已退货未退款 --> 已退款 : 退款
已退款 --> 售后完成 : 已到账

已取消 --> end 
已完成 --> end
售后完成 --> end
@enduml
---

## 注意的场景


### 如何避免重复下单? 

首先,生成订单ID; 然后,使用订单ID作为幂等标识下单;

### 如何解决ABA问题? (网络异常情况下, 请求顺序不一致导致数据错乱)

版本号的乐观锁机制
1. 查询接口将版本返回给调用方
2. 调用方将版本号作为参数给接口, 当版本一致的时候更新数据, 不一致不更新, 提示用户刷新页面





