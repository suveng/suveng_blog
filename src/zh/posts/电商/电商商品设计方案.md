---
category: 电商
tag:
  - 电商
  - 方案
order: 3
---

# 电商商品设计方案

[电商业务流程时序.md](%E7%94%B5%E5%95%86%E4%B8%9A%E5%8A%A1%E6%B5%81%E7%A8%8B%E6%97%B6%E5%BA%8F.md)

<!-- @include: ./电商业务流程时序.md#uml -->

## 商品的职责有哪些?

- 商品来源
  - 企业生产(自产自销) : 一般是有自己的供应链,公司内部记录和管理
  - 企业采购(B2B) : 从外部企业渠道采购到公司内部, 并由公司内部记录和管理
  - 企业回收(C2B) : 从个人手中回收商品, 并有公司内部记录和管理
- 商品规格
- 商品描述
- 商品定价

## 商品上下游模块依赖

- 供应链模块(商品来源)
- 订单模块(商品售卖)
- 物流模块(商品物流)

@startuml
skin rose 

node 商品

node 订单

node 物流


商品 <-- 订单 : 下单时,订单关联商品

订单 <--> 物流 : 发货时,订单和物流相互关联

物流 --> 商品 : 物流关联商品信息

@enduml

## 商品核心功能

- 录入商品
- 搜索商品列表
- 查询商品详情
- 更新库存

## 商品模型

@startuml
skin rose 

商品信息 *-- 商品规格信息
商品信息 *-- 商品类目信息
商品信息 *-- 商品标签信息
商品信息 *-- 商品支付方式
商品类目信息 -- 类目
商品标签信息 -- 标签
商品规格信息 *-- 商品规格促销信息
商品规格信息 *-- 商品规格价格信息
商品规格信息 *-- 商品规格库存信息

class 商品信息 {
  + 商品id
  + 商品版本
  + 商品标题
  + 商品副标题
  + 商品描述
  + 商品支付方式
  + 商品规格信息[]
  + 商品类目信息[]
  + 商品标签信息[]
}

class 类目 {
  + 类目id
  + 类目名称
}

class 商品类目信息 {
  + 商品id
  + 类目id
}

class 标签 {
  + 标签id
  + 标签名称
}

class 商品标签信息 {
  + 商品id
  + 标签id
}

class 商品规格信息 {
  + 商品id
  + 商品版本
  + 商品规格id
  + 商品规格描述
  + 商品规格价格信息
  + 商品规格促销信息
  + 商品规格库存信息
}

class 商品规格价格信息 {
  + 商品规格id
  + 成本价
  + 销售价
}

class 商品规格库存信息 {
  + 商品规格id
  + 库存
}

class 商品支付方式 {
  + 商品id
  + 支付方式
}

class 商品规格促销信息 {
  + 商品规格id
  + 促销规则
}

@enduml

## 搜索商品列表高性能低延时方案

使用ElasticSearch作为搜索引擎

搜索相关度排序
1. 商品类目
2. 商品标签
2. 商品标题
2. 商品副标题
3. 商品描述
4. 规格描述
5. 热卖商品

### ES数据映射
ES需要对以下数据做映射

- 商品
  - 商品类目
  - 商品标签
  - 商品规格
- 订单

### ES数据同步方案

1. 同步双写
2. 异步双写
3. 定时任务
4. 数据订阅

#### 同步双写

@startuml
skin rose

node 商品服务
database MySQL
storage ElasticSearch
interface --> 商品服务 : 更新请求
商品服务 --> MySQL : 同步更新数据
商品服务 --> ElasticSearch : 同步更新数据
@enduml 

优点: 
- 简单

缺点: 
- 商品业务和搜索业务强耦合
- 扩展性差, 需要定制搜索需求需求时, 还需要改动商品代码
- ES 和 MySQL 存在分布式事务问题


#### 保障ES数据一致性





